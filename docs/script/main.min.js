(()=>{"use strict";var e={335:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TWO_PI=t.toRadians=t.toDegrees=t.normalizeAngle=t.makeAnglePositive=t.angleDifference=void 0;const s=2*Math.PI;function a(e){return e<0&&(e+=s*Math.ceil(-e/s)),e}function n(e){return(e=a(e))%s}t.TWO_PI=s,t.makeAnglePositive=a,t.normalizeAngle=n,t.toDegrees=function(e){return 180/Math.PI*e},t.toRadians=function(e){return Math.PI/180*e},t.angleDifference=function(e,t){const a=n(t-e);return a<=Math.PI?a:s-a}},127:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Gear=t.ESurfaceType=void 0;const a=s(335),n=s(844);var r;!function(e){e[e.NONE=0]="NONE",e[e.SMOOTH=1]="SMOOTH",e[e.TEETH_SMALL=2]="TEETH_SMALL",e[e.TEETH_MEDIUM=3]="TEETH_MEDIUM",e[e.TEETH_LARGE=4]="TEETH_LARGE"}(r||(t.ESurfaceType=r={}));class i{static create(e,t){return new i(e,t.periodRays,t.periodsCount,1,null)}static slaveGear(e,t){const s=e.x-t.center.x,a=e.y-t.center.y,n=Math.max(t.maxRadius+.01,Math.sqrt(s*s+a*a)),r=i.getNextFittingDistance(n,t),o=i.tryBuildCompanionPeriod(r,t),c=Math.atan2(a,s),l={x:t.center.x+r*Math.cos(c),y:t.center.y+r*Math.sin(c)};return new i(l,o.periodRays,o.targetPeriod,-t.orientation,t)}static tryBuildCompanionPeriod(e,t){const s=[];let n=0;for(const a of t.periodSegments){s.push({angle:n,radius:e-a.startingRay.radius});const t=a.deltaDistance*a.deltaDistance,r=e-a.startingRay.radius,i=e-a.nextRay.radius,o=Math.acos((r*r+i*i-t)/(2*r*i));if(isNaN(o))throw new Error("Should not happen");n+=o}if(t.orientation>0)for(const e of s)e.angle=Math.PI-e.angle;const r=a.TWO_PI/n,i=Math.ceil(r);return{distance:e,periodRays:s,period:r,targetPeriod:i,error:i-r}}static getNextFittingDistance(e,t){let s=i.tryBuildCompanionPeriod(e,t),a=null,n=1;for(;s.error>0&&n<200;){const e=a?.5*(s.distance+a.distance):s.distance+.5;if(e===s.distance||e===(null==a?void 0:a.distance))break;const r=i.tryBuildCompanionPeriod(e,t);r.targetPeriod>s.targetPeriod||r.error>s.error?a=r:s=r,n++}return s.distance}get svgElement(){return this.svgRepresentation.container}constructor(e,t,s,r,i){this.center=e,this.periodsCount=s,this.orientation=r,this.parent=i,this.rotation=0;let o=1e10,c=-1e10;t.forEach((e=>{e.angle=(0,a.normalizeAngle)(e.angle),o=Math.min(e.radius,o),c=Math.max(e.radius,c)})),this.minRadius=o,this.maxRadius=c,this.periodAngle=a.TWO_PI/this.periodsCount;const l=t[0];if(!l)throw new Error;this.periodSegments=t.map(((e,s)=>{let a=t[s+1];a||(a={angle:l.angle+this.orientation*this.periodAngle,radius:l.radius});const r=(0,n.computeDeltaAngle)(a,e),i=(0,n.computeDistance)(a,e);return{startingRay:{angle:e.angle,radius:e.radius},nextRay:a,deltaAngle:r,deltaDistance:i}})),this.periodSegmentsReverse=this.periodSegments.slice().reverse(),this.periodSurface=0;for(const e of this.periodSegments)this.periodSurface+=e.deltaDistance;this.svgRepresentation=this.buildSvgRepresentation()}rotate(e){if(this.parent)throw new Error("Cannot rotate child gear.");this.setRotationInternal(this.rotation+e)}update(){if(!this.parent)return;const e=this.parent.rotation;{let e=Math.atan2(this.center.y-this.parent.center.y,this.center.x-this.parent.center.x);this.orientation>0&&(e=Math.PI+e),this.parent.setRotationInternal(this.parent.rotation-e);const t=this.parent.getCurrentRotatedSurface();this.rotateFromSurface(t),this.setRotationInternal(this.rotation+e)}this.parent.rotation=e}updateDisplay(e){if(this.svgRepresentation.rotationElement.setAttribute("transform",`rotate(${(0,a.toDegrees)(this.rotation)})`),this.svgRepresentation.currentSurfaceType!==e){if([r.TEETH_SMALL,r.TEETH_MEDIUM,r.TEETH_LARGE].includes(e)){let t=this.svgRepresentation.computedPaths[e];if(!t){let s;s=e===r.TEETH_SMALL?.02:e===r.TEETH_MEDIUM?.04:.06;const a=this.buildPeriodPointsWithTeeth(s);t=this.buildSvgPath(a),this.svgRepresentation.computedPaths[e]=t}this.svgRepresentation.gearElement.setAttribute("d",t)}else{let t=this.svgRepresentation.computedPaths[r.SMOOTH];if(!t){const s=this.buildPeriodPointsSmooth();t=this.buildSvgPath(s),this.svgRepresentation.computedPaths[e]=t}this.svgRepresentation.gearElement.setAttribute("d",t)}this.svgRepresentation.currentSurfaceType=e}}isPointInside(e){const t=e.x-this.center.x,s=e.y-this.center.y;return t*t+s*s<this.minRadius*this.minRadius}isChildOf(e){let t=this;for(;t;){if(t===e)return!0;t=t.parent}return!1}setRotationInternal(e){this.rotation=(0,a.normalizeAngle)(e)}getCurrentRotatedSurface(){const e=Math.floor(this.rotation/this.periodAngle);let t=this.periodAngle*e,s=this.periodSurface*e;const a=this.orientation>0?this.periodSegmentsReverse:this.periodSegments;for(const e of a){const a=t+e.deltaAngle,n=s+e.deltaDistance;if(a>=this.rotation){let t=0;return e.deltaAngle>0&&(t=(a-this.rotation)/e.deltaAngle*e.deltaDistance),s+t}t=a,s=n}throw new Error}rotateFromSurface(e){const t=Math.floor(e/this.periodSurface);this.rotation=-this.periodAngle*t;let s=this.periodSurface*t;const a=this.orientation<0?this.periodSegmentsReverse:this.periodSegments;for(const t of a){const a=s+t.deltaDistance;if(a>=e){if(t.deltaDistance>0){const s=(a-e)/t.deltaDistance*t.deltaAngle;this.rotation-=s}return}s=a,this.rotation-=t.deltaAngle}throw new Error}*walkOnPeriod(e){let t=0;for(const s of this.periodSegments){const a=(0,n.computeNormal)(s.startingRay,s.nextRay);for(;t<s.deltaDistance;){const n=t/s.deltaDistance,r=s.startingRay.angle+this.orientation*n*s.deltaAngle,i=s.startingRay.radius+n*(s.nextRay.radius-s.startingRay.radius),o={x:i*Math.cos(r),y:i*Math.sin(r)};yield{point:o,normal:a},t+=e}t-=s.deltaDistance}}buildPeriodPointsSmooth(){return this.periodSegments.map((e=>({x:e.startingRay.radius*Math.cos(e.startingRay.angle),y:e.startingRay.radius*Math.sin(e.startingRay.angle)})))}buildPeriodPointsWithTeeth(e){const t=Math.ceil(this.periodSurface/e),s=this.periodSurface/t,n=[],r=s/10;let i=0;for(const t of this.walkOnPeriod(r)){const o=Math.cos(i*a.TWO_PI/s-Math.PI/2),c=e/7*this.orientation*Math.sign(o)*Math.pow(Math.abs(o),.2);n.push({x:t.point.x+c*t.normal.x,y:t.point.y+c*t.normal.y}),i+=r}return n}buildSvgPath(e){const t=["M"];for(let s=0;s<this.periodsCount;s++){const a=this.orientation*s*this.periodAngle,n=Math.cos(a),r=Math.sin(a);for(const s of e){const e=n*s.x-r*s.y,a=r*s.x+n*s.y;t.push(`${e} ${a}`)}}return t.push("Z"),t.join(" ")}buildSvgRepresentation(){const e=document.createElementNS("http://www.w3.org/2000/svg","g");e.setAttribute("transform",`translate(${this.center.x},${this.center.y})`);const t=document.createElementNS("http://www.w3.org/2000/svg","g");e.appendChild(t);const s=document.createElementNS("http://www.w3.org/2000/svg","path");s.setAttribute("class",this.parent?i.gearClass:`${i.gearClass} ${i.gearMainClass}`),t.appendChild(s);const a=this.periodSegments[0];if(!a)throw new Error("Gear has no rays.");{const e=Math.min(.75*a.startingRay.radius,.05),s=[];for(let t=0;t<this.periodsCount;t++){s.push("M0 0");const n=a.startingRay.angle+t*this.periodAngle,r=e*Math.cos(n),i=e*Math.sin(n);s.push(`L${r} ${i}`)}const n=document.createElementNS("http://www.w3.org/2000/svg","path");n.setAttribute("d",s.join("")),n.setAttribute("class",i.gearRaysClass),t.appendChild(n)}{let e;if(this.periodsCount<3)e=document.createElementNS("http://www.w3.org/2000/svg","circle"),e.setAttribute("cx","0"),e.setAttribute("cy","0"),e.setAttribute("r",i.centerRadius.toString());else{const t=i.centerRadius*(1+.1*Math.max(0,5-this.periodsCount+3)),s=[];for(let e=0;e<this.periodsCount;e++){const n=0===e?"M":"L",r=a.startingRay.angle+e*this.periodAngle,i=t*Math.cos(r),o=t*Math.sin(r);s.push(`${n}${i} ${o}`)}s.push("Z"),e=document.createElementNS("http://www.w3.org/2000/svg","path"),e.setAttribute("d",s.join(""))}e.setAttribute("class",i.gearAxisClass),t.appendChild(e)}return{container:e,rotationElement:t,gearElement:s,currentSurfaceType:r.NONE,computedPaths:{}}}}t.Gear=i,i.centerRadius=.015,i.gearClass="gear",i.gearMainClass="main",i.gearRaysClass="gear-rays",i.gearAxisClass="gear-axis"},992:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.buildRandom=t.buildPolygon=t.buildOffPolygon=t.buildOffCircle=t.buildHeart=t.buildEllipse=t.buildCircle=void 0;const a=s(335);var n;function r(e,t,s){const a=-2*(e.center.x*Math.cos(t)+e.center.y*Math.sin(t)),r=a*a-4*(e.center.x*e.center.x+e.center.y*e.center.y-e.radius*e.radius);if(r>=0){const e=Math.sqrt(r);return s===n.NEAREST?.5*(-e-a):.5*(e-a)}return NaN}function i(e,t){const s=(e.y-t.y)/(t.x-e.x);return{a:s,b:1,c:e.y+s*e.x}}function o(e,t){const s=e.a*Math.cos(t)+e.b*Math.sin(t);return 0===s?NaN:e.c/s}!function(e){e[e.NEAREST=0]="NEAREST",e[e.FURTHEST=1]="FURTHEST"}(n||(n={})),t.buildEllipse=function(e,t){const s=[];for(let a=0;a<60;a++){const n=a/60,r=Math.PI*n;s.push({angle:r,radius:e*t/Math.sqrt(Math.pow(t*Math.cos(r),2)+Math.pow(e*Math.sin(r),2))})}return{periodRays:s,periodsCount:2}},t.buildCircle=function(e){const t=[];for(let s=0;s<40;s++){const n=s/40,r=a.TWO_PI/3*n;t.push({angle:r,radius:e})}return{periodRays:t,periodsCount:3}},t.buildOffCircle=function(e,t){const s={center:{x:t,y:0},radius:e},i=[];for(let e=0;e<120;e++){const t=e/120,o=a.TWO_PI*t,c=r(s,o,n.FURTHEST);if(isNaN(c))throw new Error;i.push({angle:o,radius:c})}return{periodRays:i,periodsCount:1}},t.buildHeart=function(e){const t=[];t.push({a:1,b:1,c:-1}),t.push({a:-1,b:1,c:1}),t.push({a:1,b:0,c:5});const s={center:{x:.2*Math.SQRT2-1,y:0},radius:.2},i=.6,c=i*Math.SQRT2-.45,l=c-i*Math.SQRT2+.4,h=[{center:{x:c,y:.57},radius:i},{center:{x:c,y:-.57},radius:i}],d={center:{x:1,y:0},radius:.2},u=[];for(let i=0;i<90;i++){const c=i/90,g=(0,a.normalizeAngle)(a.TWO_PI*c);let p=1e6;for(const e of t){const t=o(e,g);!isNaN(t)&&t>0&&(p=Math.min(t,p))}{const e=r(s,g,n.FURTHEST);!isNaN(e)&&e>0&&e*Math.cos(g)<.5*(s.center.x-1)&&(p=Math.min(e,p))}for(const e of h){const t=r(e,g,n.FURTHEST);if(!isNaN(t)&&t>0){const s={x:t*Math.cos(g),y:t*Math.sin(g)};s.y*e.center.y>=0&&s.x>l&&(p=Math.min(t,p))}}{const e=r(d,g,n.NEAREST);!isNaN(e)&&e>0&&e*Math.cos(g)<1&&(p=Math.max(e,p))}u.push({angle:(0,a.normalizeAngle)(g-0),radius:p*e*7})}return u.sort(((e,t)=>e.angle-t.angle)),{periodRays:u,periodsCount:1}},t.buildPolygon=function(e,t){const s=t,c=a.TWO_PI/t,l=i({x:1,y:0},{x:Math.cos(c),y:Math.sin(c)}),h=(0,a.toRadians)(180*(t-2)/t),d=1-.2/Math.sin(h/2),u=[{center:{x:d,y:0},radius:.2},{center:{x:d*Math.cos(c),y:d*Math.sin(c)},radius:.2}],g=(e,t,s)=>{const n=s*Math.cos(t),r=s*Math.sin(t),i=Math.atan2(e.center.y,e.center.x),o=Math.atan2(r-e.center.y,n-e.center.x);return(0,a.angleDifference)(i,o)<Math.PI-Math.PI/2-.5*h},p=[];for(let t=0;t<40;t++){const s=t/40*c;let a=o(l,s);for(const e of u){const t=r(e,s,n.FURTHEST);isNaN(t)||g(e,s,t)&&(a=Math.min(t,t))}p.push({angle:s,radius:e*a})}return{periodRays:p,periodsCount:s}},t.buildOffPolygon=function(e,t,s){const c=(0,a.toRadians)(180*(t-2)/t),l=1-.2/Math.sin(c/2),h=[],d=a.TWO_PI/t,u=s,g=[];for(let e=0;e<t;e++){const t=e*d;g.push({x:Math.cos(t)-u,y:Math.sin(t)-0}),h.push({center:{x:-u+l*Math.cos(t),y:l*Math.sin(t)-0},radius:.2})}const p=(e,t,s)=>{const n=u+s*Math.cos(t),r=0+s*Math.sin(t),i={x:e.center.x+u,y:e.center.y+0},o=Math.atan2(i.y,i.x),l=Math.atan2(r-i.y,n-i.x);return(0,a.angleDifference)(o,l)<Math.PI-Math.PI/2-.5*c},f=g.map(((e,t)=>i(e,g[(t+1)%g.length]))),m=[];for(let t=0;t<90;t++){const s=t/90*a.TWO_PI;let i=1e5;for(const e of f){const t=o(e,s);t>0&&t<i&&(i=t)}for(const e of h){const t=r(e,s,n.FURTHEST);isNaN(t)||t>0&&p(e,s,t)&&(i=Math.min(t,t))}m.push({angle:s,radius:e*i})}return{periodRays:m,periodsCount:1}},t.buildRandom=function(e){const t=1.5*e;vnoise.seed=Math.random();const s=[];for(let n=0;n<90;n++){const r=a.TWO_PI*n/90,i=.25*vnoise.fractal2d(Math.cos(r),Math.sin(r),2);s.push({angle:r,radius:e+t*i})}return{periodRays:s,periodsCount:1}}},844:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.computeNormal=t.computeDistanceSquared=t.computeDistance=t.computeDeltaAngle=void 0;const a=s(335);function n(e){return{x:e.radius*Math.cos(e.angle),y:e.radius*Math.sin(e.angle)}}function r(e,t){return(0,a.angleDifference)(e.angle,t.angle)}function i(e,t){const s=r(e,t);return e.radius*e.radius+t.radius*t.radius-2*e.radius*t.radius*Math.cos(s)}t.computeDeltaAngle=r,t.computeDistanceSquared=i,t.computeDistance=function(e,t){return Math.sqrt(i(e,t))},t.computeNormal=function(e,t){const s=n(e),a=n(t),r={x:-(a.y-s.y),y:a.x-s.x},i=Math.sqrt(r.x*r.x+r.y*r.y);return r.x/=i,r.y/=i,s.x*r.x+s.y*r.y<0&&(r.x*=-1,r.y*=-1),r}},368:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Parameters=t.ETeethSize=t.EGearShape=t.EDisplayStyle=void 0;const s="central-gear-select-id",a="shift-center-checkbox-id",n="display-style-tabs-id",r="show-rays-checkbox-id",i="show-teeth-checkbox-id",o="teeth-size-tabs-id";var c,l,h;function d(e){for(const t of e)t()}function u(){d(g.onDisplayStyleChange)}!function(e){e.ELLIPSE="ellipse",e.HEART="heart",e.TRIANGLE="triangle",e.SQUARE="square",e.PENTAGON="pentagon",e.RANDOM="random",e.CIRCLE="circle",e.OFF_CIRCLE="off-circle",e.OFF_TRIANGLE="off-triangle",e.OFF_SQUARE="off-square",e.OFF_PENTAGON="off-pentagon"}(c||(t.EGearShape=c={})),function(e){e.FLAT="flat",e.OUTLINE="outline"}(l||(t.EDisplayStyle=l={})),function(e){e.SMALL="small",e.MEDIUM="medium",e.LARGE="large"}(h||(t.ETeethSize=h={})),Page.Select.addObserver(s,(()=>{d(g.onGearShapeChange)})),Page.Checkbox.addObserver(a,(()=>{d(g.onGearShapeChange)})),Page.Button.addObserver("reset-button",(()=>{d(g.onReset)})),Page.Button.addObserver("download-button",(()=>{d(g.onDownload)})),Page.Button.addObserver("random-button",(()=>{const e=Object.values(c),t=e[Math.floor(Math.random()*e.length)];Page.Select.setValue(s,t),f(),Page.Checkbox.setChecked(a,Math.random()>.5),d(g.onReset)})),Page.Tabs.addObserver(n,u),Page.Checkbox.addObserver(r,u);class g{static get rotationSpeed(){return Page.Range.getValue("rotation-speed-range-id")}static get gearShape(){const e=Page.Select.getValue(s);if(g.shiftCenter){if(e===c.CIRCLE)return c.OFF_CIRCLE;if(e===c.TRIANGLE)return c.OFF_TRIANGLE;if(e===c.SQUARE)return c.OFF_SQUARE;if(e===c.PENTAGON)return c.OFF_PENTAGON}return e}static get displayStyle(){return Page.Tabs.getValues(n)[0]}static get showRays(){return Page.Checkbox.isChecked(r)}static get showTeeth(){return Page.Checkbox.isChecked(i)}static get teethSize(){return Page.Tabs.getValues(o)[0]}static get shiftCenter(){return Page.Checkbox.isChecked(a)}}function p(){Page.Controls.setVisibility(o,g.showTeeth)}function f(){const e=Page.Select.getValue(s),t=[c.CIRCLE,c.TRIANGLE,c.SQUARE,c.PENTAGON].includes(e);Page.Controls.setVisibility(a,t)}t.Parameters=g,g.onGearShapeChange=[],g.onReset=[],g.onDownload=[],g.onDisplayStyleChange=[],Page.Checkbox.addObserver(i,p),p(),Page.Select.addObserver(s,f),f()},680:function(e,t,s){var a=this&&this.__createBinding||(Object.create?function(e,t,s,a){void 0===a&&(a=s);var n=Object.getOwnPropertyDescriptor(t,s);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,a,n)}:function(e,t,s,a){void 0===a&&(a=s),e[a]=t[s]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)"default"!==s&&Object.prototype.hasOwnProperty.call(e,s)&&a(t,e,s);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.RandomScene=void 0;const i=s(127),o=r(s(992)),c=s(368),l=s(532),h=s(152);function d(e,t){return e+(t-e)*Math.random()}class u extends h.Scene{static create(e,t){let s=new u(e,t);for(let a=0;a<5;a++){const a=new u(e,t);a.secondaryGears.length>s.secondaryGears.length&&(s=a)}return s}constructor(e,t){const s=.1;let a;switch(t){case c.EGearShape.ELLIPSE:a=o.buildEllipse(s,d(.4,.7)*s);break;case c.EGearShape.HEART:a=o.buildHeart(.017);break;case c.EGearShape.OFF_CIRCLE:a=o.buildOffCircle(s,d(.3,.9)*s);break;case c.EGearShape.TRIANGLE:a=o.buildPolygon(s,3);break;case c.EGearShape.SQUARE:a=o.buildPolygon(s,4);break;case c.EGearShape.PENTAGON:a=o.buildPolygon(s,5);break;case c.EGearShape.OFF_TRIANGLE:a=o.buildOffPolygon(s,3,d(.3,.5));break;case c.EGearShape.OFF_SQUARE:a=o.buildOffPolygon(s,4,d(.3,.5));break;case c.EGearShape.OFF_PENTAGON:a=o.buildOffPolygon(s,5,d(.3,.5));break;case c.EGearShape.CIRCLE:a=o.buildCircle(s);break;case c.EGearShape.RANDOM:a=o.buildRandom(s);break;default:throw new Error(t)}super(e,i.Gear.create({x:0,y:0},a)),this.secondaryGears=[];const n=e.width,r=e.height;for(let e=0;e<300;e++){const e={x:d(-.5*n,.5*n),y:d(-.5*r,.5*r)};if(this.allGears.find((t=>(0,l.distance)(e,t.center)<t.minRadius)))continue;const t=this.tryBuildGear(e);t&&t.minRadius>1.2*i.Gear.centerRadius&&t.maxRadius<.3&&this.secondaryGears.push(t)}}}t.RandomScene=u},152:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Scene=void 0;const a=s(127),n=s(368),r=s(532);function i(e,t){for(;e.length>0;){const s=e.indexOf(t);if(s<0)return;e.splice(s,1)}}t.Scene=class{constructor(e,t){this.secondaryGears=[],this.mobileGear=null,this.svgCanvas=e;const s=()=>{const e=n.Parameters.displayStyle===n.EDisplayStyle.FLAT,t="#FF6A00",s=e?"#333333":"green",r=`.${a.Gear.gearClass} {\n    fill:           red;\n    fill-opacity:   ${e?.7:.4};\n    stroke:         red;\n    stroke-width:   ${e?0:.004};\n}\n.${a.Gear.gearClass}.${a.Gear.gearMainClass} {\n    fill:   ${t};\n    stroke: ${t};\n}\n.${a.Gear.gearRaysClass} {\n    ${n.Parameters.showRays?"":"display: none;"}\n    stroke:         ${s};\n    stroke-width:   0.006;\n}\n.${a.Gear.gearAxisClass} {\n    fill: ${s};\n}`;this.svgCanvas.setStyle(r)};n.Parameters.onDisplayStyleChange.push(s),s(),this.mainGear=t,this.onMouseMove=()=>{const e=this.getMousePosition();this.mobileGear&&(this.svgCanvas.removeChild(this.mobileGear.svgElement),this.mobileGear=null);const t=this.getHoveredGear();t||(this.mobileGear=this.tryBuildGear(e),this.mobileGear&&this.svgCanvas.addChild(this.mobileGear.svgElement)),this.svgCanvas.cursor=this.mobileGear||t?"":"not-allowed"},this.onMouseUp=()=>{this.mobileGear&&(this.secondaryGears.push(this.mobileGear),this.mobileGear=null)},this.onMouseUpRight=e=>{if(2===e.button){const e=this.getHoveredGear();if(e){const t=[];for(const s of this.secondaryGears)s.isChildOf(e)?this.svgCanvas.removeChild(s.svgElement):t.push(s);this.secondaryGears=t,this.onMouseMove()}}}}update(e){var t;this.mainGear.rotate(5*e*n.Parameters.rotationSpeed/1e3);for(const e of this.secondaryGears)e.update();null===(t=this.mobileGear)||void 0===t||t.update(),this.updateDisplay()}attach(){this.detach(),Page.Canvas.Observers.mouseMove.push(this.onMouseMove),Page.Canvas.Observers.mouseUp.push(this.onMouseUp),this.svgCanvas.onMouseUp.push(this.onMouseUpRight);for(const e of[this.mainGear,...this.secondaryGears])this.svgCanvas.addChild(e.svgElement)}detach(){i(Page.Canvas.Observers.mouseMove,this.onMouseMove),i(Page.Canvas.Observers.mouseUp,this.onMouseUp),i(this.svgCanvas.onMouseUp,this.onMouseUpRight)}tryBuildGear(e){const t=this.findClosestGear(e);let s=null;try{s=a.Gear.slaveGear(e,t)}catch(e){console.debug(e)}if(s)for(const e of this.allGears)if(e!==t&&(0,r.distance)(s.center,e.center)-s.maxRadius-e.maxRadius<=0)return null;return s}get allGears(){return[this.mainGear,...this.secondaryGears]}updateDisplay(){var e;const t=n.Parameters.showTeeth,s=n.Parameters.teethSize;let r;r=t?s===n.ETeethSize.SMALL?a.ESurfaceType.TEETH_SMALL:s===n.ETeethSize.MEDIUM?a.ESurfaceType.TEETH_MEDIUM:a.ESurfaceType.TEETH_LARGE:a.ESurfaceType.SMOOTH;for(const e of this.allGears)e.updateDisplay(r);null===(e=this.mobileGear)||void 0===e||e.updateDisplay(r);const i=this.getHoveredGear(),o=(.6+.3*(.5+.5*Math.cos(performance.now()/150))).toFixed(2);for(const e of this.secondaryGears)i&&e.isChildOf(i)?e.svgElement.style.opacity=o:e.svgElement.style.opacity=""}getHoveredGear(){if(!this.mobileGear){const e=this.getMousePosition();return this.secondaryGears.find((t=>t.isPointInside(e)))||null}return null}findClosestGear(e){let t=this.mainGear,s=(0,r.distance)(e,t.center)-t.maxRadius;for(const a of this.secondaryGears){const n=(0,r.distance)(e,a.center)-a.maxRadius;n<s&&(t=a,s=n)}return t}getMousePosition(){const e=Page.Canvas.getAspectRatio(),t=Page.Canvas.getMousePosition();return{x:(2*t[0]-1)*Math.max(1,e),y:(2*t[1]-1)*Math.max(1,1/e)}}}},528:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SvgCanvas=void 0;const a=s(532);t.SvgCanvas=class{constructor(){this.onMouseUp=[],this.svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svg.style.position="absolute",this.svg.style.top="0",this.svg.style.left="0",this.svg.style.width="100%",this.svg.style.height="100%",this.svg.style.pointerEvents="none",this.styleElement=document.createElementNS("http://www.w3.org/2000/svg","style"),this.svg.appendChild(this.styleElement),this.backgroundElement=document.createElementNS("http://www.w3.org/2000/svg","rect"),this.backgroundElement.setAttribute("x","-100%"),this.backgroundElement.setAttribute("y","-100%"),this.backgroundElement.setAttribute("width","200%"),this.backgroundElement.setAttribute("height","200%"),this.backgroundElement.setAttribute("fill","black"),this.svg.appendChild(this.backgroundElement);const e=()=>{const e=this.width,t=this.height;this.svg.setAttribute("viewBox",`${-.5*e} ${-.5*t} ${e} ${t}`)};Page.Canvas.Observers.canvasResize.push(e),e();const t=Page.Canvas.getCanvasContainer();if(!t)throw new Error;this.canvasContainer=t,this.canvasContainer.insertBefore(this.svg,Page.Canvas.getCanvas()),this.canvasContainer.addEventListener("mouseup",(e=>{for(const t of this.onMouseUp)t(e)})),this.canvasContainer.addEventListener("contextmenu",(e=>{e.preventDefault()}))}clear(){let e=this.svg.firstChild;for(;e;)this.svg.removeChild(e),e=this.svg.firstChild;this.svg.appendChild(this.styleElement),this.svg.appendChild(this.backgroundElement)}removeChild(e){this.svg.removeChild(e)}addChild(e){this.svg.appendChild(e)}download(){this.svg.setAttribute("xmlns","http://www.w3.org/2000/svg"),this.svg.setAttribute("version","1.1");const e=`<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n${this.svg.outerHTML}`;this.svg.removeAttribute("xmlns"),this.svg.removeAttribute("version"),(0,a.downloadTextFile)("gears.svg",e)}setStyle(e){this.styleElement.innerHTML=e}get width(){return 2*Math.max(1,Page.Canvas.getAspectRatio())}get height(){return 2*Math.max(1,1/Page.Canvas.getAspectRatio())}set cursor(e){this.canvasContainer.style.cursor=e}}},532:(e,t)=>{function s(e,t){const s=e.x-t.x,a=e.y-t.y;return s*s+a*a}Object.defineProperty(t,"__esModule",{value:!0}),t.downloadTextFile=t.distanceSquared=t.distance=void 0,t.distanceSquared=s,t.distance=function(e,t){const a=s(e,t);return Math.sqrt(a)},t.downloadTextFile=function(e,t){const s="text/plain",a=new Blob([t],{type:s});if(void 0!==window.navigator&&void 0!==window.navigator.msSaveBlob)window.navigator.msSaveBlob(a,e);else{const t=URL.createObjectURL(a),n=document.createElement("a");n.download=e,n.href=t,n.dataset.downloadurl=`${s}:${n.download}:${n.href}`,n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n),setTimeout((()=>{URL.revokeObjectURL(t)}),5e3)}}}},t={};function s(a){var n=t[a];if(void 0!==n)return n.exports;var r=t[a]={exports:{}};return e[a].call(r.exports,r,r.exports,s),r.exports}(()=>{const e=s(368),t=s(680),a=s(528);!function(){const s=new a.SvgCanvas;let n=t.RandomScene.create(s,e.Parameters.gearShape);function r(){n.detach(),s.clear(),n=t.RandomScene.create(s,e.Parameters.gearShape),n.attach()}n.attach(),e.Parameters.onGearShapeChange.push(r),e.Parameters.onReset.push(r),e.Parameters.onDownload.push((()=>s.download()));let i=performance.now();requestAnimationFrame((function e(){const t=performance.now(),s=t-i;i=t,n.update(s),requestAnimationFrame(e)}))}()})()})();
//# sourceMappingURL=main.min.js.map