(()=>{"use strict";var e={518:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TWO_PI=t.toRadians=t.toDegrees=t.normalizeAngle=t.makeAnglePositive=t.angleDifference=void 0;const a=2*Math.PI;function s(e){return e<0&&(e+=a*Math.ceil(-e/a)),e}function n(e){return(e=s(e))%a}t.TWO_PI=a,t.makeAnglePositive=s,t.normalizeAngle=n,t.toDegrees=function(e){return 180/Math.PI*e},t.toRadians=function(e){return Math.PI/180*e},t.angleDifference=function(e,t){const s=n(t-e);return s<=Math.PI?s:a-s}},350:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Gear=t.ESurfaceType=void 0;const s=a(518),n=a(130);var r;!function(e){e[e.NONE=0]="NONE",e[e.SMOOTH=1]="SMOOTH",e[e.TEETH_SMALL=2]="TEETH_SMALL",e[e.TEETH_MEDIUM=3]="TEETH_MEDIUM",e[e.TEETH_LARGE=4]="TEETH_LARGE"}(r||(r={})),t.ESurfaceType=r;class i{static create(e,t){return new i(e,t.periodRays,t.periodsCount,1)}static slaveGear(e,t){const a=e.x-t.center.x,s=e.y-t.center.y,n=Math.max(t.maxRadius+.01,Math.sqrt(a*a+s*s)),r=i.getNextFittingDistance(n,t),o=i.tryBuildCompanionPeriod(r,t),c=Math.atan2(s,a),l={x:t.center.x+r*Math.cos(c),y:t.center.y+r*Math.sin(c)};return new i(l,o.periodRays,o.targetPeriod,-t.orientation,t)}static tryBuildCompanionPeriod(e,t){const a=[];let n=0;for(const s of t.periodSegments){a.push({angle:n,radius:e-s.startingRay.radius});const t=s.deltaDistance*s.deltaDistance,r=e-s.startingRay.radius,i=e-s.nextRay.radius,o=Math.acos((r*r+i*i-t)/(2*r*i));if(isNaN(o))throw new Error("Should not happen");n+=o}if(t.orientation>0)for(const e of a)e.angle=Math.PI-e.angle;const r=s.TWO_PI/n,i=Math.ceil(r);return{distance:e,periodRays:a,period:r,targetPeriod:i,error:i-r}}static getNextFittingDistance(e,t){let a=i.tryBuildCompanionPeriod(e,t),s=null,n=1;for(;a.error>0&&n<200;){const e=s?.5*(a.distance+s.distance):a.distance+.5;if(e===a.distance||e===(null==s?void 0:s.distance))break;const r=i.tryBuildCompanionPeriod(e,t);r.targetPeriod>a.targetPeriod||r.error>a.error?s=r:a=r,n++}return a.distance}get svgElement(){return this.svgRepresentation.container}constructor(e,t,a,r,i){this.center=e,this.periodsCount=a,this.orientation=r,this.parent=i,this.rotation=0;let o=1e10,c=-1e10;t.forEach((e=>{e.angle=(0,s.normalizeAngle)(e.angle),o=Math.min(e.radius,o),c=Math.max(e.radius,c)})),this.minRadius=o,this.maxRadius=c,this.periodAngle=s.TWO_PI/this.periodsCount;const l=t[0];if(!l)throw new Error;this.periodSegments=t.map(((e,a)=>{let s=t[a+1];s||(s={angle:l.angle+this.orientation*this.periodAngle,radius:l.radius});const r=(0,n.computeDeltaAngle)(s,e),i=(0,n.computeDistance)(s,e);return{startingRay:{angle:e.angle,radius:e.radius},nextRay:s,deltaAngle:r,deltaDistance:i}})),this.periodSegmentsReverse=this.periodSegments.slice().reverse(),this.periodSurface=0;for(const e of this.periodSegments)this.periodSurface+=e.deltaDistance;this.svgRepresentation=this.buildSvgRepresentation()}rotate(e){if(this.parent)throw new Error("Cannot rotate child gear.");this.setRotationInternal(this.rotation+e)}update(){if(!this.parent)return;const e=this.parent.rotation;{let e=Math.atan2(this.center.y-this.parent.center.y,this.center.x-this.parent.center.x);this.orientation>0&&(e=Math.PI+e),this.parent.setRotationInternal(this.parent.rotation-e);const t=this.parent.getCurrentRotatedSurface();this.rotateFromSurface(t),this.setRotationInternal(this.rotation+e)}this.parent.rotation=e}updateDisplay(e){if(this.svgRepresentation.rotationElement.setAttribute("transform",`rotate(${(0,s.toDegrees)(this.rotation)})`),this.svgRepresentation.currentSurfaceType!==e){if([r.TEETH_SMALL,r.TEETH_MEDIUM,r.TEETH_LARGE].includes(e)){let t=this.svgRepresentation.computedPaths[e];if(!t){let a;a=e===r.TEETH_SMALL?.02:e===r.TEETH_MEDIUM?.04:.06;const s=this.buildPeriodPointsWithTeeth(a);t=this.buildSvgPath(s),this.svgRepresentation.computedPaths[e]=t}this.svgRepresentation.gearElement.setAttribute("d",t)}else{let t=this.svgRepresentation.computedPaths[r.SMOOTH];if(!t){const a=this.buildPeriodPointsSmooth();t=this.buildSvgPath(a),this.svgRepresentation.computedPaths[e]=t}this.svgRepresentation.gearElement.setAttribute("d",t)}this.svgRepresentation.currentSurfaceType=e}}setRotationInternal(e){this.rotation=(0,s.normalizeAngle)(e)}getCurrentRotatedSurface(){const e=Math.floor(this.rotation/this.periodAngle);let t=this.periodAngle*e,a=this.periodSurface*e;const s=this.orientation>0?this.periodSegmentsReverse:this.periodSegments;for(const e of s){const s=t+e.deltaAngle,n=a+e.deltaDistance;if(s>=this.rotation){let t=0;return e.deltaAngle>0&&(t=(s-this.rotation)/e.deltaAngle*e.deltaDistance),a+t}t=s,a=n}throw new Error}rotateFromSurface(e){const t=Math.floor(e/this.periodSurface);this.rotation=-this.periodAngle*t;let a=this.periodSurface*t;const s=this.orientation<0?this.periodSegmentsReverse:this.periodSegments;for(const t of s){const s=a+t.deltaDistance;if(s>=e){if(t.deltaDistance>0){const a=(s-e)/t.deltaDistance*t.deltaAngle;this.rotation-=a}return}a=s,this.rotation-=t.deltaAngle}throw new Error}*walkOnPeriod(e){let t=0;for(const a of this.periodSegments){const s=(0,n.computeNormal)(a.startingRay,a.nextRay);for(;t<a.deltaDistance;){const n=t/a.deltaDistance,r=a.startingRay.angle+this.orientation*n*a.deltaAngle,i=a.startingRay.radius+n*(a.nextRay.radius-a.startingRay.radius),o={x:i*Math.cos(r),y:i*Math.sin(r)};yield{point:o,normal:s},t+=e}t-=a.deltaDistance}}buildPeriodPointsSmooth(){return this.periodSegments.map((e=>({x:e.startingRay.radius*Math.cos(e.startingRay.angle),y:e.startingRay.radius*Math.sin(e.startingRay.angle)})))}buildPeriodPointsWithTeeth(e){const t=Math.ceil(this.periodSurface/e),a=this.periodSurface/t,n=[],r=a/10;let i=0;for(const t of this.walkOnPeriod(r)){const o=Math.cos(i*s.TWO_PI/a-Math.PI/2),c=e/7*this.orientation*Math.sign(o)*Math.pow(Math.abs(o),.2);n.push({x:t.point.x+c*t.normal.x,y:t.point.y+c*t.normal.y}),i+=r}return n}buildSvgPath(e){const t=["M"];for(let a=0;a<this.periodsCount;a++){const s=this.orientation*a*this.periodAngle,n=Math.cos(s),r=Math.sin(s);for(const a of e){const e=n*a.x-r*a.y,s=r*a.x+n*a.y;t.push(`${e} ${s}`)}}return t.push("Z"),t.join(" ")}buildSvgRepresentation(){const e=document.createElementNS("http://www.w3.org/2000/svg","g");e.setAttribute("transform",`translate(${this.center.x},${this.center.y})`);const t=document.createElementNS("http://www.w3.org/2000/svg","g");e.appendChild(t);const a=document.createElementNS("http://www.w3.org/2000/svg","path");a.setAttribute("class",this.parent?i.gearClass:`${i.gearClass} ${i.gearMainClass}`),t.appendChild(a);const s=this.periodSegments[0];if(!s)throw new Error("Gear has no rays.");{const e=Math.min(.75*s.startingRay.radius,.05),a=[];for(let t=0;t<this.periodsCount;t++){a.push("M0 0");const n=s.startingRay.angle+t*this.periodAngle,r=e*Math.cos(n),i=e*Math.sin(n);a.push(`L${r} ${i}`)}const n=document.createElementNS("http://www.w3.org/2000/svg","path");n.setAttribute("d",a.join("")),n.setAttribute("class",i.gearRaysClass),t.appendChild(n)}{let e;if(this.periodsCount<3)e=document.createElementNS("http://www.w3.org/2000/svg","circle"),e.setAttribute("cx","0"),e.setAttribute("cy","0"),e.setAttribute("r",i.centerRadius.toString());else{const t=i.centerRadius*(1+.1*Math.max(0,5-this.periodsCount+3)),a=[];for(let e=0;e<this.periodsCount;e++){const n=0===e?"M":"L",r=s.startingRay.angle+e*this.periodAngle,i=t*Math.cos(r),o=t*Math.sin(r);a.push(`${n}${i} ${o}`)}a.push("Z"),e=document.createElementNS("http://www.w3.org/2000/svg","path"),e.setAttribute("d",a.join(""))}e.setAttribute("class",i.gearAxisClass),t.appendChild(e)}return{container:e,rotationElement:t,gearElement:a,currentSurfaceType:r.NONE,computedPaths:{}}}}t.Gear=i,i.centerRadius=.015,i.gearClass="gear",i.gearMainClass="main",i.gearRaysClass="gear-rays",i.gearAxisClass="gear-axis"},841:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.buildRandom=t.buildPolygon=t.buildOffPolygon=t.buildOffCircle=t.buildHeart=t.buildEllipse=t.buildCircle=void 0;const s=a(518);var n;function r(e,t,a){const s=-2*(e.center.x*Math.cos(t)+e.center.y*Math.sin(t)),r=s*s-4*(e.center.x*e.center.x+e.center.y*e.center.y-e.radius*e.radius);if(r>=0){const e=Math.sqrt(r);return a===n.NEAREST?.5*(-e-s):.5*(e-s)}return NaN}function i(e,t){const a=(e.y-t.y)/(t.x-e.x);return{a,b:1,c:e.y+a*e.x}}function o(e,t){const a=e.a*Math.cos(t)+e.b*Math.sin(t);return 0===a?NaN:e.c/a}!function(e){e[e.NEAREST=0]="NEAREST",e[e.FURTHEST=1]="FURTHEST"}(n||(n={})),t.buildEllipse=function(e,t){const a=[];for(let s=0;s<60;s++){const n=s/60,r=Math.PI*n;a.push({angle:r,radius:e*t/Math.sqrt(Math.pow(t*Math.cos(r),2)+Math.pow(e*Math.sin(r),2))})}return{periodRays:a,periodsCount:2}},t.buildCircle=function(e){const t=[];for(let a=0;a<40;a++){const n=a/40,r=s.TWO_PI/3*n;t.push({angle:r,radius:e})}return{periodRays:t,periodsCount:3}},t.buildOffCircle=function(e,t){const a={center:{x:t,y:0},radius:e},i=[];for(let e=0;e<120;e++){const t=e/120,o=s.TWO_PI*t,c=r(a,o,n.FURTHEST);if(isNaN(c))throw new Error;i.push({angle:o,radius:c})}return{periodRays:i,periodsCount:1}},t.buildHeart=function(e){const t=[];t.push({a:1,b:1,c:-1}),t.push({a:-1,b:1,c:1}),t.push({a:1,b:0,c:5});const a={center:{x:.2*Math.SQRT2-1,y:0},radius:.2},i=.6,c=i*Math.SQRT2-.45,l=c-i*Math.SQRT2+.4,h=[{center:{x:c,y:.57},radius:i},{center:{x:c,y:-.57},radius:i}],d={center:{x:1,y:0},radius:.2},u=[];for(let i=0;i<90;i++){const c=i/90,g=(0,s.normalizeAngle)(s.TWO_PI*c);let p=1e6;for(const e of t){const t=o(e,g);!isNaN(t)&&t>0&&(p=Math.min(t,p))}{const e=r(a,g,n.FURTHEST);!isNaN(e)&&e>0&&e*Math.cos(g)<.5*(a.center.x-1)&&(p=Math.min(e,p))}for(const e of h){const t=r(e,g,n.FURTHEST);if(!isNaN(t)&&t>0){const a={x:t*Math.cos(g),y:t*Math.sin(g)};a.y*e.center.y>=0&&a.x>l&&(p=Math.min(t,p))}}{const e=r(d,g,n.NEAREST);!isNaN(e)&&e>0&&e*Math.cos(g)<1&&(p=Math.max(e,p))}u.push({angle:(0,s.normalizeAngle)(g-0),radius:p*e*7})}return u.sort(((e,t)=>e.angle-t.angle)),{periodRays:u,periodsCount:1}},t.buildPolygon=function(e,t){const a=t,c=s.TWO_PI/t,l=i({x:1,y:0},{x:Math.cos(c),y:Math.sin(c)}),h=(0,s.toRadians)(180*(t-2)/t),d=1-.2/Math.sin(h/2),u=[{center:{x:d,y:0},radius:.2},{center:{x:d*Math.cos(c),y:d*Math.sin(c)},radius:.2}],g=(e,t,a)=>{const n=a*Math.cos(t),r=a*Math.sin(t),i=Math.atan2(e.center.y,e.center.x),o=Math.atan2(r-e.center.y,n-e.center.x);return(0,s.angleDifference)(i,o)<Math.PI-Math.PI/2-.5*h},p=[];for(let t=0;t<40;t++){const a=t/40*c;let s=o(l,a);for(const e of u){const t=r(e,a,n.FURTHEST);isNaN(t)||g(e,a,t)&&(s=Math.min(t,t))}p.push({angle:a,radius:e*s})}return{periodRays:p,periodsCount:a}},t.buildOffPolygon=function(e,t,a){const c=(0,s.toRadians)(180*(t-2)/t),l=1-.2/Math.sin(c/2),h=[],d=s.TWO_PI/t,u=a,g=[];for(let e=0;e<t;e++){const t=e*d;g.push({x:Math.cos(t)-u,y:Math.sin(t)-0}),h.push({center:{x:-u+l*Math.cos(t),y:l*Math.sin(t)-0},radius:.2})}const p=(e,t,a)=>{const n=u+a*Math.cos(t),r=0+a*Math.sin(t),i={x:e.center.x+u,y:e.center.y+0},o=Math.atan2(i.y,i.x),l=Math.atan2(r-i.y,n-i.x);return(0,s.angleDifference)(o,l)<Math.PI-Math.PI/2-.5*c},E=g.map(((e,t)=>i(e,g[(t+1)%g.length]))),f=[];for(let t=0;t<90;t++){const a=t/90*s.TWO_PI;let i=1e5;for(const e of E){const t=o(e,a);t>0&&t<i&&(i=t)}for(const e of h){const t=r(e,a,n.FURTHEST);isNaN(t)||t>0&&p(e,a,t)&&(i=Math.min(t,t))}f.push({angle:a,radius:e*i})}return{periodRays:f,periodsCount:1}},t.buildRandom=function(e){const t=1.5*e;vnoise.seed=Math.random();const a=[];for(let n=0;n<90;n++){const r=s.TWO_PI*n/90,i=.25*vnoise.fractal2d(Math.cos(r),Math.sin(r),2);a.push({angle:r,radius:e+t*i})}return{periodRays:a,periodsCount:1}}},130:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.computeNormal=t.computeDistanceSquared=t.computeDistance=t.computeDeltaAngle=void 0;const s=a(518);function n(e){return{x:e.radius*Math.cos(e.angle),y:e.radius*Math.sin(e.angle)}}function r(e,t){return(0,s.angleDifference)(e.angle,t.angle)}function i(e,t){const a=r(e,t);return e.radius*e.radius+t.radius*t.radius-2*e.radius*t.radius*Math.cos(a)}t.computeDeltaAngle=r,t.computeDistanceSquared=i,t.computeDistance=function(e,t){return Math.sqrt(i(e,t))},t.computeNormal=function(e,t){const a=n(e),s=n(t),r={x:-(s.y-a.y),y:s.x-a.x},i=Math.sqrt(r.x*r.x+r.y*r.y);return r.x/=i,r.y/=i,a.x*r.x+a.y*r.y<0&&(r.x*=-1,r.y*=-1),r}},61:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Parameters=t.ETeethSize=t.EGearShape=t.EDisplayStyle=void 0;const a={CENTRAL_GEAR_SELECT_ID:"central-gear-select-id",SHIFT_CENTER_CHECKBOX_ID:"shift-center-checkbox-id",ROTATION_SPEED_RANGE:"rotation-speed-range-id",RESET_BUTTON_ID:"reset-button",RANDOM_BUTTON_ID:"random-button",DISPLAY_STYLE_TABS_ID:"display-style-tabs-id",SHOW_RAYS_CHECKBOX_ID:"show-rays-checkbox-id",SHOW_TEETH_CHECKBOX_ID:"show-teeth-checkbox-id",TEETH_SIZE_TABS_ID:"teeth-size-tabs-id",DOWNLOAD_BUTTON_ID:"download-button"};var s,n,r;function i(e){for(const t of e)t()}function o(){i(c.onDisplayStyleChange)}!function(e){e.ELLIPSE="ellipse",e.HEART="heart",e.TRIANGLE="triangle",e.SQUARE="square",e.PENTAGON="pentagon",e.RANDOM="random",e.CIRCLE="circle",e.OFF_CIRCLE="off-circle",e.OFF_TRIANGLE="off-triangle",e.OFF_SQUARE="off-square",e.OFF_PENTAGON="off-pentagon"}(s||(s={})),t.EGearShape=s,function(e){e.FLAT="flat",e.OUTLINE="outline"}(n||(n={})),t.EDisplayStyle=n,function(e){e.SMALL="small",e.MEDIUM="medium",e.LARGE="large"}(r||(r={})),t.ETeethSize=r,Page.Select.addObserver(a.CENTRAL_GEAR_SELECT_ID,(()=>{i(c.onGearShapeChange)})),Page.Checkbox.addObserver(a.SHIFT_CENTER_CHECKBOX_ID,(()=>{i(c.onGearShapeChange)})),Page.Button.addObserver(a.RESET_BUTTON_ID,(()=>{i(c.onReset)})),Page.Button.addObserver(a.DOWNLOAD_BUTTON_ID,(()=>{i(c.onDownload)})),Page.Button.addObserver(a.RANDOM_BUTTON_ID,(()=>{const e=Object.values(s),t=e[Math.floor(Math.random()*e.length)];Page.Select.setValue(a.CENTRAL_GEAR_SELECT_ID,t),i(c.onReset)})),Page.Tabs.addObserver(a.DISPLAY_STYLE_TABS_ID,o),Page.Checkbox.addObserver(a.SHOW_RAYS_CHECKBOX_ID,o);class c{static get rotationSpeed(){return Page.Range.getValue(a.ROTATION_SPEED_RANGE)}static get gearShape(){const e=Page.Select.getValue(a.CENTRAL_GEAR_SELECT_ID);if(c.shiftCenter){if(e===s.CIRCLE)return s.OFF_CIRCLE;if(e===s.TRIANGLE)return s.OFF_TRIANGLE;if(e===s.SQUARE)return s.OFF_SQUARE;if(e===s.PENTAGON)return s.OFF_PENTAGON}return e}static get displayStyle(){return Page.Tabs.getValues(a.DISPLAY_STYLE_TABS_ID)[0]}static get showRays(){return Page.Checkbox.isChecked(a.SHOW_RAYS_CHECKBOX_ID)}static get showTeeth(){return Page.Checkbox.isChecked(a.SHOW_TEETH_CHECKBOX_ID)}static get teethSize(){return Page.Tabs.getValues(a.TEETH_SIZE_TABS_ID)[0]}static get shiftCenter(){return Page.Checkbox.isChecked(a.SHIFT_CENTER_CHECKBOX_ID)}}function l(){Page.Controls.setVisibility(a.TEETH_SIZE_TABS_ID,c.showTeeth)}function h(){const e=Page.Select.getValue(a.CENTRAL_GEAR_SELECT_ID),t=[s.CIRCLE,s.TRIANGLE,s.SQUARE,s.PENTAGON].includes(e);Page.Controls.setVisibility(a.SHIFT_CENTER_CHECKBOX_ID,t)}t.Parameters=c,c.onGearShapeChange=[],c.onReset=[],c.onDownload=[],c.onDisplayStyleChange=[],Page.Checkbox.addObserver(a.SHOW_TEETH_CHECKBOX_ID,l),l(),Page.Select.addObserver(a.CENTRAL_GEAR_SELECT_ID,h),h()},217:function(e,t,a){var s=this&&this.__createBinding||(Object.create?function(e,t,a,s){void 0===s&&(s=a);var n=Object.getOwnPropertyDescriptor(t,a);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,s,n)}:function(e,t,a,s){void 0===s&&(s=a),e[s]=t[a]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&s(t,e,a);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.RandomScene=void 0;const i=a(350),o=r(a(841)),c=a(61),l=a(513),h=a(881);function d(e,t){return e+(t-e)*Math.random()}class u extends h.Scene{static create(e,t){let a=new u(e,t);for(let s=0;s<5;s++){const s=new u(e,t);s.secondaryGears.length>a.secondaryGears.length&&(a=s)}return a}constructor(e,t){const a=.1;let s;switch(t){case c.EGearShape.ELLIPSE:s=o.buildEllipse(a,d(.4,.7)*a);break;case c.EGearShape.HEART:s=o.buildHeart(.017);break;case c.EGearShape.OFF_CIRCLE:s=o.buildOffCircle(a,d(.3,.9)*a);break;case c.EGearShape.TRIANGLE:s=o.buildPolygon(a,3);break;case c.EGearShape.SQUARE:s=o.buildPolygon(a,4);break;case c.EGearShape.PENTAGON:s=o.buildPolygon(a,5);break;case c.EGearShape.OFF_TRIANGLE:s=o.buildOffPolygon(a,3,d(.3,.5));break;case c.EGearShape.OFF_SQUARE:s=o.buildOffPolygon(a,4,d(.3,.5));break;case c.EGearShape.OFF_PENTAGON:s=o.buildOffPolygon(a,5,d(.3,.5));break;case c.EGearShape.CIRCLE:s=o.buildCircle(a);break;case c.EGearShape.RANDOM:s=o.buildRandom(a);break;default:throw new Error(t)}super(e,i.Gear.create({x:0,y:0},s)),this.secondaryGears=[];const n=e.width,r=e.height;for(let e=0;e<300;e++){const e={x:d(-.5*n,.5*n),y:d(-.5*r,.5*r)};if(this.allGears.find((t=>(0,l.distance)(e,t.center)<t.minRadius)))continue;const t=this.tryBuildGear(e);t&&t.minRadius>1.2*i.Gear.centerRadius&&t.maxRadius<.3&&this.secondaryGears.push(t)}}}t.RandomScene=u},881:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Scene=void 0;const s=a(350),n=a(61),r=a(513);function i(e,t){for(;e.length>0;){const a=e.indexOf(t);if(a<0)return;e.splice(a,1)}}t.Scene=class{constructor(e,t){this.secondaryGears=[],this.mobileGear=null,this.svgCanvas=e;const a=()=>{const e=n.Parameters.displayStyle===n.EDisplayStyle.FLAT,t="#FF6A00",a=e?"#333333":"green",r=`.${s.Gear.gearClass} {\n    fill:           red;\n    fill-opacity:   ${e?.7:.4};\n    stroke:         red;\n    stroke-width:   ${e?0:.004};\n}\n.${s.Gear.gearClass}.${s.Gear.gearMainClass} {\n    fill:   ${t};\n    stroke: ${t};\n}\n.${s.Gear.gearRaysClass} {\n    ${n.Parameters.showRays?"":"display: none;"}\n    stroke:         ${a};\n    stroke-width:   0.006;\n}\n.${s.Gear.gearAxisClass} {\n    fill: ${a};\n}`;this.svgCanvas.setStyle(r)};n.Parameters.onDisplayStyleChange.push(a),a(),this.mainGear=t,this.onMouseMove=()=>{const e=Page.Canvas.getAspectRatio(),t=Page.Canvas.getMousePosition(),a={x:(2*t[0]-1)*Math.max(1,e),y:(2*t[1]-1)*Math.max(1,1/e)};this.mobileGear&&this.svgCanvas.removeChild(this.mobileGear.svgElement),this.mobileGear=this.tryBuildGear(a),this.mobileGear?(this.svgCanvas.cursor="",this.svgCanvas.addChild(this.mobileGear.svgElement)):this.svgCanvas.cursor="not-allowed"},this.onMouseUp=()=>{this.mobileGear&&(this.secondaryGears.push(this.mobileGear),this.mobileGear=null)}}update(e){var t;this.mainGear.rotate(5*e*n.Parameters.rotationSpeed/1e3);for(const e of this.secondaryGears)e.update();null===(t=this.mobileGear)||void 0===t||t.update(),this.updateDisplay()}attach(){this.detach(),Page.Canvas.Observers.mouseMove.push(this.onMouseMove),Page.Canvas.Observers.mouseUp.push(this.onMouseUp);for(const e of[this.mainGear,...this.secondaryGears])this.svgCanvas.addChild(e.svgElement)}detach(){i(Page.Canvas.Observers.mouseMove,this.onMouseMove),i(Page.Canvas.Observers.mouseUp,this.onMouseUp)}tryBuildGear(e){const t=this.findClosestGear(e);let a=null;try{a=s.Gear.slaveGear(e,t)}catch(e){console.debug(e)}if(a)for(const e of this.allGears)if(e!==t&&(0,r.distance)(a.center,e.center)-a.maxRadius-e.maxRadius<=0)return null;return a}get allGears(){return[this.mainGear,...this.secondaryGears]}updateDisplay(){var e;const t=n.Parameters.showTeeth,a=n.Parameters.teethSize;let r;r=t?a===n.ETeethSize.SMALL?s.ESurfaceType.TEETH_SMALL:a===n.ETeethSize.MEDIUM?s.ESurfaceType.TEETH_MEDIUM:s.ESurfaceType.TEETH_LARGE:s.ESurfaceType.SMOOTH;for(const e of this.allGears)e.updateDisplay(r);null===(e=this.mobileGear)||void 0===e||e.updateDisplay(r)}findClosestGear(e){let t=this.mainGear,a=(0,r.distance)(e,t.center)-t.maxRadius;for(const s of this.secondaryGears){const n=(0,r.distance)(e,s.center)-s.maxRadius;n<a&&(t=s,a=n)}return t}}},133:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SvgCanvas=void 0;const s=a(513);t.SvgCanvas=class{constructor(){this.svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svg.style.position="absolute",this.svg.style.top="0",this.svg.style.left="0",this.svg.style.width="100%",this.svg.style.height="100%",this.svg.style.pointerEvents="none",this.styleElement=document.createElementNS("http://www.w3.org/2000/svg","style"),this.svg.appendChild(this.styleElement),this.backgroundElement=document.createElementNS("http://www.w3.org/2000/svg","rect"),this.backgroundElement.setAttribute("x","-100%"),this.backgroundElement.setAttribute("y","-100%"),this.backgroundElement.setAttribute("width","200%"),this.backgroundElement.setAttribute("height","200%"),this.backgroundElement.setAttribute("fill","black"),this.svg.appendChild(this.backgroundElement);const e=()=>{const e=this.width,t=this.height;this.svg.setAttribute("viewBox",`${-.5*e} ${-.5*t} ${e} ${t}`)};Page.Canvas.Observers.canvasResize.push(e),e(),this.canvasContainer=Page.Canvas.getCanvasContainer(),this.canvasContainer.insertBefore(this.svg,Page.Canvas.getCanvas())}clear(){let e=this.svg.firstChild;for(;e;)this.svg.removeChild(e),e=this.svg.firstChild;this.svg.appendChild(this.styleElement),this.svg.appendChild(this.backgroundElement)}removeChild(e){this.svg.removeChild(e)}addChild(e){this.svg.appendChild(e)}download(){this.svg.setAttribute("xmlns","http://www.w3.org/2000/svg"),this.svg.setAttribute("version","1.1");const e=`<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n${this.svg.outerHTML}`;this.svg.removeAttribute("xmlns"),this.svg.removeAttribute("version"),(0,s.downloadTextFile)("gears.svg",e)}setStyle(e){this.styleElement.innerHTML=e}get width(){return 2*Math.max(1,Page.Canvas.getAspectRatio())}get height(){return 2*Math.max(1,1/Page.Canvas.getAspectRatio())}set cursor(e){this.canvasContainer.style.cursor=e}}},513:(e,t)=>{function a(e,t){const a=e.x-t.x,s=e.y-t.y;return a*a+s*s}Object.defineProperty(t,"__esModule",{value:!0}),t.downloadTextFile=t.distanceSquared=t.distance=void 0,t.distanceSquared=a,t.distance=function(e,t){const s=a(e,t);return Math.sqrt(s)},t.downloadTextFile=function(e,t){const a="text/plain",s=new Blob([t],{type:a});if(void 0!==window.navigator&&void 0!==window.navigator.msSaveBlob)window.navigator.msSaveBlob(s,e);else{const t=URL.createObjectURL(s),n=document.createElement("a");n.download=e,n.href=t,n.dataset.downloadurl=`${a}:${n.download}:${n.href}`,n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n),setTimeout((()=>{URL.revokeObjectURL(t)}),5e3)}}}},t={};function a(s){var n=t[s];if(void 0!==n)return n.exports;var r=t[s]={exports:{}};return e[s].call(r.exports,r,r.exports,a),r.exports}(()=>{const e=a(61),t=a(217),s=a(133);!function(){const a=new s.SvgCanvas;let n=t.RandomScene.create(a,e.Parameters.gearShape);function r(){n.detach(),a.clear(),n=t.RandomScene.create(a,e.Parameters.gearShape),n.attach()}n.attach(),e.Parameters.onGearShapeChange.push(r),e.Parameters.onReset.push(r),e.Parameters.onDownload.push((()=>a.download()));let i=performance.now();requestAnimationFrame((function e(){const t=performance.now(),a=t-i;i=t,n.update(a),requestAnimationFrame(e)}))}()})()})();
//# sourceMappingURL=main.min.js.map