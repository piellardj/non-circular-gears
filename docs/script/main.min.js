(()=>{"use strict";var e={518:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TWO_PI=t.toRadians=t.toDegrees=t.normalizeAngle=t.makeAnglePositive=t.angleDifference=void 0;const n=2*Math.PI;function a(e){return e<0&&(e+=n*Math.ceil(-e/n)),e}function s(e){return(e=a(e))%n}t.TWO_PI=n,t.makeAnglePositive=a,t.normalizeAngle=s,t.toDegrees=function(e){return 180/Math.PI*e},t.toRadians=function(e){return Math.PI/180*e},t.angleDifference=function(e,t){const a=s(t-e);return a<=Math.PI?a:n-a}},350:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Gear=t.ESurfaceType=void 0;const a=n(518),s=n(130);var r;!function(e){e[e.NONE=0]="NONE",e[e.SMOOTH=1]="SMOOTH",e[e.TEETH_SMALL=2]="TEETH_SMALL",e[e.TEETH_MEDIUM=3]="TEETH_MEDIUM",e[e.TEETH_LARGE=4]="TEETH_LARGE"}(r||(r={})),t.ESurfaceType=r;const i=document.createElementNS("http://www.w3.org/2000/svg","style");i.innerHTML=".gear {\n    fill: red;\n    fill-opacity: 0.4;\n    stroke: red;\n    stroke-width: 0.004;\n}\n.gear.main {\n    fill: #FF6A00;\n    stroke: #FF6A00;\n}\n.gear-rays {\n    stroke: green;\n    stroke-width: 0.006;\n}\n.gear-axis {\n    fill: green;\n}";class o{static create(e,t){return new o(e,t.periodRays,t.periodsCount,1)}static slaveGear(e,t){const n=e.x-t.center.x,a=e.y-t.center.y,s=Math.max(t.maxRadius+.01,Math.sqrt(n*n+a*a)),r=o.getNextFittingDistance(s,t),i=o.tryBuildCompanionPeriod(r,t),c=Math.atan2(a,n),h={x:t.center.x+r*Math.cos(c),y:t.center.y+r*Math.sin(c)};return new o(h,i.periodRays,i.targetPeriod,-t.orientation,t)}static tryBuildCompanionPeriod(e,t){const n=[];let s=0;for(const a of t.periodSegments){n.push({angle:s,radius:e-a.startingRay.radius});const t=a.deltaDistance*a.deltaDistance,r=e-a.startingRay.radius,i=e-a.nextRay.radius,o=Math.acos((r*r+i*i-t)/(2*r*i));if(isNaN(o))throw new Error("Should not happen");s+=o}if(t.orientation>0)for(const e of n)e.angle=Math.PI-e.angle;const r=a.TWO_PI/s,i=Math.ceil(r);return{distance:e,periodRays:n,period:r,targetPeriod:i,error:i-r}}static getNextFittingDistance(e,t){let n=o.tryBuildCompanionPeriod(e,t),a=null,s=1;for(;n.error>0&&s<200;){const e=a?.5*(n.distance+a.distance):n.distance+.5;if(e===n.distance||e===(null==a?void 0:a.distance))break;const r=o.tryBuildCompanionPeriod(e,t);r.targetPeriod>n.targetPeriod||r.error>n.error?a=r:n=r,s++}return n.distance}get svgElement(){return this.svgRepresentation.container}constructor(e,t,n,r,i){this.center=e,this.periodsCount=n,this.orientation=r,this.parent=i,this.rotation=0;let o=1e10,c=-1e10;t.forEach((e=>{e.angle=(0,a.normalizeAngle)(e.angle),o=Math.min(e.radius,o),c=Math.max(e.radius,c)})),this.minRadius=o,this.maxRadius=c,this.periodAngle=a.TWO_PI/this.periodsCount;const h=t[0];if(!h)throw new Error;this.periodSegments=t.map(((e,n)=>{let a=t[n+1];a||(a={angle:h.angle+this.orientation*this.periodAngle,radius:h.radius});const r=(0,s.computeDeltaAngle)(a,e),i=(0,s.computeDistance)(a,e);return{startingRay:{angle:e.angle,radius:e.radius},nextRay:a,deltaAngle:r,deltaDistance:i}})),this.periodSegmentsReverse=this.periodSegments.slice().reverse(),this.periodSurface=0;for(const e of this.periodSegments)this.periodSurface+=e.deltaDistance;this.svgRepresentation=this.buildSvgRepresentation()}rotate(e){if(this.parent)throw new Error("Cannot rotate child gear.");this.setRotationInternal(this.rotation+e)}update(){if(!this.parent)return;const e=this.parent.rotation;{let e=Math.atan2(this.center.y-this.parent.center.y,this.center.x-this.parent.center.x);this.orientation>0&&(e=Math.PI+e),this.parent.setRotationInternal(this.parent.rotation-e);const t=this.parent.getCurrentRotatedSurface();this.rotateFromSurface(t),this.setRotationInternal(this.rotation+e)}this.parent.rotation=e}updateDisplay(e){if(this.svgRepresentation.rotationElement.setAttribute("transform",`rotate(${(0,a.toDegrees)(this.rotation)})`),this.svgRepresentation.currentSurfaceType!==e){if([r.TEETH_SMALL,r.TEETH_MEDIUM,r.TEETH_LARGE].includes(e)){let t=this.svgRepresentation.computedPaths[e];if(!t){let n;n=e===r.TEETH_SMALL?.02:e===r.TEETH_MEDIUM?.04:.06;const a=this.buildPeriodPointsWithTeeth(n);t=this.buildSvgPath(a),this.svgRepresentation.computedPaths[e]=t}this.svgRepresentation.gearElement.setAttribute("d",t)}else{let t=this.svgRepresentation.computedPaths[r.SMOOTH];if(!t){const n=this.buildPeriodPointsSmooth();t=this.buildSvgPath(n),this.svgRepresentation.computedPaths[e]=t}this.svgRepresentation.gearElement.setAttribute("d",t)}this.svgRepresentation.currentSurfaceType=e}}setRotationInternal(e){this.rotation=(0,a.normalizeAngle)(e)}getCurrentRotatedSurface(){const e=Math.floor(this.rotation/this.periodAngle);let t=this.periodAngle*e,n=this.periodSurface*e;const a=this.orientation>0?this.periodSegmentsReverse:this.periodSegments;for(const e of a){const a=t+e.deltaAngle,s=n+e.deltaDistance;if(a>=this.rotation){let t=0;return e.deltaAngle>0&&(t=(a-this.rotation)/e.deltaAngle*e.deltaDistance),n+t}t=a,n=s}throw new Error}rotateFromSurface(e){const t=Math.floor(e/this.periodSurface);this.rotation=-this.periodAngle*t;let n=this.periodSurface*t;const a=this.orientation<0?this.periodSegmentsReverse:this.periodSegments;for(const t of a){const a=n+t.deltaDistance;if(a>=e){if(t.deltaDistance>0){const n=(a-e)/t.deltaDistance*t.deltaAngle;this.rotation-=n}return}n=a,this.rotation-=t.deltaAngle}throw new Error}*walkOnPeriod(e){let t=0;for(const n of this.periodSegments){const a=(0,s.computeNormal)(n.startingRay,n.nextRay);for(;t<n.deltaDistance;){const s=t/n.deltaDistance,r=n.startingRay.angle+this.orientation*s*n.deltaAngle,i=n.startingRay.radius+s*(n.nextRay.radius-n.startingRay.radius),o={x:i*Math.cos(r),y:i*Math.sin(r)};yield{point:o,normal:a},t+=e}t-=n.deltaDistance}}buildPeriodPointsSmooth(){return this.periodSegments.map((e=>({x:e.startingRay.radius*Math.cos(e.startingRay.angle),y:e.startingRay.radius*Math.sin(e.startingRay.angle)})))}buildPeriodPointsWithTeeth(e){const t=Math.ceil(this.periodSurface/e),n=this.periodSurface/t,s=[],r=n/10;let i=0;for(const t of this.walkOnPeriod(r)){const o=Math.cos(i*a.TWO_PI/n-Math.PI/2),c=e/7*this.orientation*Math.sign(o)*Math.pow(Math.abs(o),.2);s.push({x:t.point.x+c*t.normal.x,y:t.point.y+c*t.normal.y}),i+=r}return s}buildSvgPath(e){const t=["M"];for(let n=0;n<this.periodsCount;n++){const a=this.orientation*n*this.periodAngle,s=Math.cos(a),r=Math.sin(a);for(const n of e){const e=s*n.x-r*n.y,a=r*n.x+s*n.y;t.push(`${e} ${a}`)}}return t.push("Z"),t.join(" ")}buildSvgRepresentation(){const e=document.createElementNS("http://www.w3.org/2000/svg","g");e.setAttribute("transform",`translate(${this.center.x},${this.center.y})`);const t=document.createElementNS("http://www.w3.org/2000/svg","g");e.appendChild(t);const n=document.createElementNS("http://www.w3.org/2000/svg","path");n.setAttribute("class",this.parent?"gear":"gear main"),t.appendChild(n);const a=this.periodSegments[0];if(!a)throw new Error("Gear has no rays.");{const e=Math.min(.75*a.startingRay.radius,.05),n=[];for(let t=0;t<this.periodsCount;t++){n.push("M0 0");const s=a.startingRay.angle+t*this.periodAngle,r=e*Math.cos(s),i=e*Math.sin(s);n.push(`L${r} ${i}`)}const s=document.createElementNS("http://www.w3.org/2000/svg","path");s.setAttribute("d",n.join("")),s.setAttribute("class","gear-rays"),t.appendChild(s)}{let e;if(this.periodsCount<3)e=document.createElementNS("http://www.w3.org/2000/svg","circle"),e.setAttribute("cx","0"),e.setAttribute("cy","0"),e.setAttribute("r",o.centerRadius.toString());else{const t=o.centerRadius*(1+.1*Math.max(0,5-this.periodsCount+3)),n=[];for(let e=0;e<this.periodsCount;e++){const s=0===e?"M":"L",r=a.startingRay.angle+e*this.periodAngle,i=t*Math.cos(r),o=t*Math.sin(r);n.push(`${s}${i} ${o}`)}n.push("Z"),e=document.createElementNS("http://www.w3.org/2000/svg","path"),e.setAttribute("d",n.join(""))}e.setAttribute("class","gear-axis"),t.appendChild(e)}return{container:e,rotationElement:t,gearElement:n,currentSurfaceType:r.NONE,computedPaths:{}}}}t.Gear=o,o.centerRadius=.015,o.svgStyleElement=i},841:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.buildRandom=t.buildPolygon=t.buildOffPolygon=t.buildOffCircle=t.buildHeart=t.buildEllipse=t.buildCircle=void 0;const a=n(518);var s;function r(e,t,n){const a=-2*(e.center.x*Math.cos(t)+e.center.y*Math.sin(t)),r=a*a-4*(e.center.x*e.center.x+e.center.y*e.center.y-e.radius*e.radius);if(r>=0){const e=Math.sqrt(r);return n===s.NEAREST?.5*(-e-a):.5*(e-a)}return NaN}function i(e,t){const n=(e.y-t.y)/(t.x-e.x);return{a:n,b:1,c:e.y+n*e.x}}function o(e,t){const n=e.a*Math.cos(t)+e.b*Math.sin(t);return 0===n?NaN:e.c/n}!function(e){e[e.NEAREST=0]="NEAREST",e[e.FURTHEST=1]="FURTHEST"}(s||(s={})),t.buildEllipse=function(e,t){const n=[];for(let a=0;a<60;a++){const s=a/60,r=Math.PI*s;n.push({angle:r,radius:e*t/Math.sqrt(Math.pow(t*Math.cos(r),2)+Math.pow(e*Math.sin(r),2))})}return{periodRays:n,periodsCount:2}},t.buildCircle=function(e){const t=[];for(let n=0;n<40;n++){const s=n/40,r=a.TWO_PI/3*s;t.push({angle:r,radius:e})}return{periodRays:t,periodsCount:3}},t.buildOffCircle=function(e,t){const n={center:{x:t,y:0},radius:e},i=[];for(let e=0;e<120;e++){const t=e/120,o=a.TWO_PI*t,c=r(n,o,s.FURTHEST);if(isNaN(c))throw new Error;i.push({angle:o,radius:c})}return{periodRays:i,periodsCount:1}},t.buildHeart=function(e){const t=[];t.push({a:1,b:1,c:-1}),t.push({a:-1,b:1,c:1}),t.push({a:1,b:0,c:5});const n={center:{x:.2*Math.SQRT2-1,y:0},radius:.2},i=.6,c=i*Math.SQRT2-.45,h=c-i*Math.SQRT2+.4,l=[{center:{x:c,y:.57},radius:i},{center:{x:c,y:-.57},radius:i}],d={center:{x:1,y:0},radius:.2},u=[];for(let i=0;i<90;i++){const c=i/90,g=(0,a.normalizeAngle)(a.TWO_PI*c);let p=1e6;for(const e of t){const t=o(e,g);!isNaN(t)&&t>0&&(p=Math.min(t,p))}{const e=r(n,g,s.FURTHEST);!isNaN(e)&&e>0&&e*Math.cos(g)<.5*(n.center.x-1)&&(p=Math.min(e,p))}for(const e of l){const t=r(e,g,s.FURTHEST);if(!isNaN(t)&&t>0){const n={x:t*Math.cos(g),y:t*Math.sin(g)};n.y*e.center.y>=0&&n.x>h&&(p=Math.min(t,p))}}{const e=r(d,g,s.NEAREST);!isNaN(e)&&e>0&&e*Math.cos(g)<1&&(p=Math.max(e,p))}u.push({angle:(0,a.normalizeAngle)(g-0),radius:p*e*7})}return u.sort(((e,t)=>e.angle-t.angle)),{periodRays:u,periodsCount:1}},t.buildPolygon=function(e,t){const n=t,c=a.TWO_PI/t,h=i({x:1,y:0},{x:Math.cos(c),y:Math.sin(c)}),l=(0,a.toRadians)(180*(t-2)/t),d=1-.2/Math.sin(l/2),u=[{center:{x:d,y:0},radius:.2},{center:{x:d*Math.cos(c),y:d*Math.sin(c)},radius:.2}],g=(e,t,n)=>{const s=n*Math.cos(t),r=n*Math.sin(t),i=Math.atan2(e.center.y,e.center.x),o=Math.atan2(r-e.center.y,s-e.center.x);return(0,a.angleDifference)(i,o)<Math.PI-Math.PI/2-.5*l},p=[];for(let t=0;t<40;t++){const n=t/40*c;let a=o(h,n);for(const e of u){const t=r(e,n,s.FURTHEST);isNaN(t)||g(e,n,t)&&(a=Math.min(t,t))}p.push({angle:n,radius:e*a})}return{periodRays:p,periodsCount:n}},t.buildOffPolygon=function(e,t,n){const c=(0,a.toRadians)(180*(t-2)/t),h=1-.2/Math.sin(c/2),l=[],d=a.TWO_PI/t,u=n,g=[];for(let e=0;e<t;e++){const t=e*d;g.push({x:Math.cos(t)-u,y:Math.sin(t)-0}),l.push({center:{x:-u+h*Math.cos(t),y:h*Math.sin(t)-0},radius:.2})}const p=(e,t,n)=>{const s=u+n*Math.cos(t),r=0+n*Math.sin(t),i={x:e.center.x+u,y:e.center.y+0},o=Math.atan2(i.y,i.x),h=Math.atan2(r-i.y,s-i.x);return(0,a.angleDifference)(o,h)<Math.PI-Math.PI/2-.5*c},f=g.map(((e,t)=>i(e,g[(t+1)%g.length]))),E=[];for(let t=0;t<90;t++){const n=t/90*a.TWO_PI;let i=1e5;for(const e of f){const t=o(e,n);t>0&&t<i&&(i=t)}for(const e of l){const t=r(e,n,s.FURTHEST);isNaN(t)||t>0&&p(e,n,t)&&(i=Math.min(t,t))}E.push({angle:n,radius:e*i})}return{periodRays:E,periodsCount:1}},t.buildRandom=function(e){const t=1.5*e;vnoise.seed=Math.random();const n=[];for(let s=0;s<90;s++){const r=a.TWO_PI*s/90,i=.25*vnoise.fractal2d(Math.cos(r),Math.sin(r),2);n.push({angle:r,radius:e+t*i})}return{periodRays:n,periodsCount:1}}},130:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.computeNormal=t.computeDistanceSquared=t.computeDistance=t.computeDeltaAngle=void 0;const a=n(518);function s(e){return{x:e.radius*Math.cos(e.angle),y:e.radius*Math.sin(e.angle)}}function r(e,t){return(0,a.angleDifference)(e.angle,t.angle)}function i(e,t){const n=r(e,t);return e.radius*e.radius+t.radius*t.radius-2*e.radius*t.radius*Math.cos(n)}t.computeDeltaAngle=r,t.computeDistanceSquared=i,t.computeDistance=function(e,t){return Math.sqrt(i(e,t))},t.computeNormal=function(e,t){const n=s(e),a=s(t),r={x:-(a.y-n.y),y:a.x-n.x},i=Math.sqrt(r.x*r.x+r.y*r.y);return r.x/=i,r.y/=i,n.x*r.x+n.y*r.y<0&&(r.x*=-1,r.y*=-1),r}},61:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Parameters=t.ETeethSize=t.EGearShape=void 0;const n={CENTRAL_GEAR_SELECT_ID:"central-gear-select-id",SHIFT_CENTER_CHECKBOX_ID:"shift-center-checkbox-id",ROTATION_SPEED_RANGE:"rotation-speed-range-id",RESET_BUTTON_ID:"reset-button",RANDOM_BUTTON_ID:"random-button",SHOW_TEETH_CHECKBOX_ID:"show-teeth-checkbox-id",TEETH_SIZE_TABS_ID:"teeth-size-tabs-id",DOWNLOAD_BUTTON_ID:"download-button"};var a,s;function r(e){for(const t of e)t()}!function(e){e.ELLIPSE="ellipse",e.HEART="heart",e.TRIANGLE="triangle",e.SQUARE="square",e.PENTAGON="pentagon",e.RANDOM="random",e.CIRCLE="circle",e.OFF_CIRCLE="off-circle",e.OFF_TRIANGLE="off-triangle",e.OFF_SQUARE="off-square",e.OFF_PENTAGON="off-pentagon"}(a||(a={})),t.EGearShape=a,function(e){e.SMALL="small",e.MEDIUM="medium",e.LARGE="large"}(s||(s={})),t.ETeethSize=s,Page.Select.addObserver(n.CENTRAL_GEAR_SELECT_ID,(()=>{r(i.onGearShapeChange)})),Page.Checkbox.addObserver(n.SHIFT_CENTER_CHECKBOX_ID,(()=>{r(i.onGearShapeChange)})),Page.Button.addObserver(n.RESET_BUTTON_ID,(()=>{r(i.onReset)})),Page.Button.addObserver(n.DOWNLOAD_BUTTON_ID,(()=>{r(i.onDownload)})),Page.Button.addObserver(n.RANDOM_BUTTON_ID,(()=>{const e=Object.values(a),t=e[Math.floor(Math.random()*e.length)];Page.Select.setValue(n.CENTRAL_GEAR_SELECT_ID,t),r(i.onReset)}));class i{static get rotationSpeed(){return Page.Range.getValue(n.ROTATION_SPEED_RANGE)}static get gearShape(){const e=Page.Select.getValue(n.CENTRAL_GEAR_SELECT_ID);if(i.shiftCenter){if(e===a.CIRCLE)return a.OFF_CIRCLE;if(e===a.TRIANGLE)return a.OFF_TRIANGLE;if(e===a.SQUARE)return a.OFF_SQUARE;if(e===a.PENTAGON)return a.OFF_PENTAGON}return e}static get showTeeth(){return Page.Checkbox.isChecked(n.SHOW_TEETH_CHECKBOX_ID)}static get teethSize(){return Page.Tabs.getValues(n.TEETH_SIZE_TABS_ID)[0]}static get shiftCenter(){return Page.Checkbox.isChecked(n.SHIFT_CENTER_CHECKBOX_ID)}}function o(){Page.Controls.setVisibility(n.TEETH_SIZE_TABS_ID,i.showTeeth)}function c(){const e=Page.Select.getValue(n.CENTRAL_GEAR_SELECT_ID),t=[a.CIRCLE,a.TRIANGLE,a.SQUARE,a.PENTAGON].includes(e);Page.Controls.setVisibility(n.SHIFT_CENTER_CHECKBOX_ID,t)}t.Parameters=i,i.onGearShapeChange=[],i.onReset=[],i.onDownload=[],Page.Checkbox.addObserver(n.SHOW_TEETH_CHECKBOX_ID,o),o(),Page.Select.addObserver(n.CENTRAL_GEAR_SELECT_ID,c),c()},217:function(e,t,n){var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n);var s=Object.getOwnPropertyDescriptor(t,n);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,a,s)}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return s(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.RandomScene=void 0;const i=n(350),o=r(n(841)),c=n(61),h=n(513),l=n(881);function d(e,t){return e+(t-e)*Math.random()}class u extends l.Scene{static create(e,t){let n=new u(e,t);for(let a=0;a<5;a++){const a=new u(e,t);a.secondaryGears.length>n.secondaryGears.length&&(n=a)}return n}constructor(e,t){const n=.1;let a;switch(t){case c.EGearShape.ELLIPSE:a=o.buildEllipse(n,d(.2,.6)*n);break;case c.EGearShape.HEART:a=o.buildHeart(.017);break;case c.EGearShape.OFF_CIRCLE:a=o.buildOffCircle(n,d(.3,.9)*n);break;case c.EGearShape.TRIANGLE:a=o.buildPolygon(n,3);break;case c.EGearShape.SQUARE:a=o.buildPolygon(n,4);break;case c.EGearShape.PENTAGON:a=o.buildPolygon(n,5);break;case c.EGearShape.OFF_TRIANGLE:a=o.buildOffPolygon(n,3,d(.3,.5));break;case c.EGearShape.OFF_SQUARE:a=o.buildOffPolygon(n,4,d(.3,.5));break;case c.EGearShape.OFF_PENTAGON:a=o.buildOffPolygon(n,5,d(.3,.5));break;case c.EGearShape.CIRCLE:a=o.buildCircle(n);break;case c.EGearShape.RANDOM:a=o.buildRandom(n);break;default:throw new Error(t)}super(e,i.Gear.create({x:0,y:0},a)),this.secondaryGears=[];const s=e.width,r=e.height;for(let e=0;e<300;e++){const e={x:d(-.5*s,.5*s),y:d(-.5*r,.5*r)};if(this.allGears.find((t=>(0,h.distance)(e,t.center)<t.minRadius)))continue;const t=this.tryBuildGear(e);t&&t.minRadius>1.2*i.Gear.centerRadius&&t.maxRadius<.3&&this.secondaryGears.push(t)}}}t.RandomScene=u},881:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Scene=void 0;const a=n(350),s=n(61),r=n(513);function i(e,t){for(;e.length>0;){const n=e.indexOf(t);if(n<0)return;e.splice(n,1)}}t.Scene=class{constructor(e,t){this.secondaryGears=[],this.mobileGear=null,this.svgCanvas=e,this.svgCanvas.addChild(a.Gear.svgStyleElement),this.mainGear=t,this.onMouseMove=()=>{const e=Page.Canvas.getAspectRatio(),t=Page.Canvas.getMousePosition(),n={x:(2*t[0]-1)*Math.max(1,e),y:(2*t[1]-1)*Math.max(1,1/e)};this.mobileGear&&this.svgCanvas.removeChild(this.mobileGear.svgElement),this.mobileGear=this.tryBuildGear(n),this.mobileGear?(this.svgCanvas.cursor="",this.svgCanvas.addChild(this.mobileGear.svgElement)):this.svgCanvas.cursor="not-allowed"},this.onMouseUp=()=>{this.mobileGear&&(this.secondaryGears.push(this.mobileGear),this.mobileGear=null)}}update(e){var t;this.mainGear.rotate(5*e*s.Parameters.rotationSpeed/1e3);for(const e of this.secondaryGears)e.update();null===(t=this.mobileGear)||void 0===t||t.update(),this.updateDisplay()}attach(){this.detach(),Page.Canvas.Observers.mouseMove.push(this.onMouseMove),Page.Canvas.Observers.mouseUp.push(this.onMouseUp);for(const e of[this.mainGear,...this.secondaryGears])this.svgCanvas.addChild(e.svgElement)}detach(){i(Page.Canvas.Observers.mouseMove,this.onMouseMove),i(Page.Canvas.Observers.mouseUp,this.onMouseUp)}tryBuildGear(e){const t=this.findClosestGear(e);let n=null;try{n=a.Gear.slaveGear(e,t)}catch(e){console.debug(e)}if(n)for(const e of this.allGears)if(e!==t&&(0,r.distance)(n.center,e.center)-n.maxRadius-e.maxRadius<=0)return null;return n}get allGears(){return[this.mainGear,...this.secondaryGears]}updateDisplay(){var e;const t=s.Parameters.showTeeth,n=s.Parameters.teethSize;let r;r=t?n===s.ETeethSize.SMALL?a.ESurfaceType.TEETH_SMALL:n===s.ETeethSize.MEDIUM?a.ESurfaceType.TEETH_MEDIUM:a.ESurfaceType.TEETH_LARGE:a.ESurfaceType.SMOOTH;for(const e of this.allGears)e.updateDisplay(r);null===(e=this.mobileGear)||void 0===e||e.updateDisplay(r)}findClosestGear(e){let t=this.mainGear,n=(0,r.distance)(e,t.center)-t.maxRadius;for(const a of this.secondaryGears){const s=(0,r.distance)(e,a.center)-a.maxRadius;s<n&&(t=a,n=s)}return t}}},133:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SvgCanvas=void 0;const a=n(513);t.SvgCanvas=class{constructor(){this.svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svg.style.position="absolute",this.svg.style.top="0",this.svg.style.left="0",this.svg.style.width="100%",this.svg.style.height="100%",this.svg.style.pointerEvents="none",this.backgroundElement=document.createElementNS("http://www.w3.org/2000/svg","rect"),this.backgroundElement.setAttribute("x","-100%"),this.backgroundElement.setAttribute("y","-100%"),this.backgroundElement.setAttribute("width","200%"),this.backgroundElement.setAttribute("height","200%"),this.backgroundElement.setAttribute("fill","black"),this.svg.appendChild(this.backgroundElement);const e=()=>{const e=this.width,t=this.height;this.svg.setAttribute("viewBox",`${-.5*e} ${-.5*t} ${e} ${t}`)};Page.Canvas.Observers.canvasResize.push(e),e(),this.canvasContainer=Page.Canvas.getCanvasContainer(),this.canvasContainer.insertBefore(this.svg,Page.Canvas.getCanvas())}clear(){let e=this.svg.firstChild;for(;e;)this.svg.removeChild(e),e=this.svg.firstChild;this.svg.appendChild(this.backgroundElement)}removeChild(e){this.svg.removeChild(e)}addChild(e){this.svg.appendChild(e)}download(){this.svg.setAttribute("xmlns","http://www.w3.org/2000/svg"),this.svg.setAttribute("version","1.1");const e=`<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n${this.svg.outerHTML}`;this.svg.removeAttribute("xmlns"),this.svg.removeAttribute("version"),(0,a.downloadTextFile)("gears.svg",e)}get width(){return 2*Math.max(1,Page.Canvas.getAspectRatio())}get height(){return 2*Math.max(1,1/Page.Canvas.getAspectRatio())}set cursor(e){this.canvasContainer.style.cursor=e}}},513:(e,t)=>{function n(e,t){const n=e.x-t.x,a=e.y-t.y;return n*n+a*a}Object.defineProperty(t,"__esModule",{value:!0}),t.downloadTextFile=t.distanceSquared=t.distance=void 0,t.distanceSquared=n,t.distance=function(e,t){const a=n(e,t);return Math.sqrt(a)},t.downloadTextFile=function(e,t){const n="text/plain",a=new Blob([t],{type:n});if(void 0!==window.navigator&&void 0!==window.navigator.msSaveBlob)window.navigator.msSaveBlob(a,e);else{const t=URL.createObjectURL(a),s=document.createElement("a");s.download=e,s.href=t,s.dataset.downloadurl=`${n}:${s.download}:${s.href}`,s.style.display="none",document.body.appendChild(s),s.click(),document.body.removeChild(s),setTimeout((()=>{URL.revokeObjectURL(t)}),5e3)}}}},t={};function n(a){var s=t[a];if(void 0!==s)return s.exports;var r=t[a]={exports:{}};return e[a].call(r.exports,r,r.exports,n),r.exports}(()=>{const e=n(61),t=n(217),a=n(133);!function(){const n=new a.SvgCanvas;let s=t.RandomScene.create(n,e.Parameters.gearShape);function r(){s.detach(),n.clear(),s=t.RandomScene.create(n,e.Parameters.gearShape),s.attach()}s.attach(),e.Parameters.onGearShapeChange.push(r),e.Parameters.onReset.push(r),e.Parameters.onDownload.push((()=>n.download()));let i=performance.now();requestAnimationFrame((function e(){const t=performance.now(),n=t-i;i=t,s.update(n),requestAnimationFrame(e)}))}()})()})();
//# sourceMappingURL=main.min.js.map